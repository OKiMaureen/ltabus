language: go
go:
  - tip

before_install:
  - travis_retry curl -sf https://up.apex.sh/install | sudo sh
  - sudo up upgrade
  - ./allthebusstops.sh
  - npx critical --inline templates/index.html > index.critical.html
  - test -s index.critical.html && mv index.critical.html templates/index.html
  - go get

matrix:
  include:
    - if: branch = master
      deploy:
        provider: script
        script: up deploy  # https://bus2.dabase.com
        on:
          branch: master
    - if: tag IS present
      deploy:
        provider: script
        script: up deploy production  # https://bus.dabase.com/
        on:
          tags: true
